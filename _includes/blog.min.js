!function(){function t(t,e){return Math.random()*(e-t)+t}function e(){for(var t="0123456789ABCDEF",e="#",n=0;6>n;n++)e+=t[Math.floor(16*Math.random())];return e}function n(){w.clearRect(0,0,g.width,g.height),S.forEach(function(t){t.f=[0,0]});for(var t=0;t<S.length;t++){i(S[t]);for(var e=t+1;e<S.length;e++){var s=a(S[t],S[e]);o(S[t],S[e],s)}}S.forEach(function(t){l(t),r(t),c(t)}),u(n)}function r(t){t.v[0]+=t.f[0]/t.m,t.v[1]+=t.f[1]/t.m}function o(t,e,n){var r=t.sign*e.sign;t.f[0]+=n[0]*r,t.f[1]+=n[1]*r,e.f[0]-=n[0]*r,e.f[1]-=n[1]*r}function i(t){if(0!==d&&0!==v){var e=t.l[0]-d,n=t.l[1]-v,r=e*e,o=n*n,i=Math.max(r+o,1),a=m*t.m*t.m/i,l=Math.sign(e)*Math.sqrt(a*r/i),c=Math.sign(n)*Math.sqrt(a*o/i);t.f[0]+=l,t.f[1]+=c}}function a(t,e){var n=e.l[0]-t.l[0],r=e.l[1]-t.l[1],o=n*n,i=r*r,a=Math.max(o+i,1),l=f*t.m*e.m/a,c=Math.sign(n)*Math.sqrt(l*o/a),s=Math.sign(r)*Math.sqrt(l*i/a);return[c,s]}function l(t){w.beginPath(),w.arc(t.l[0],t.l[1],t.r,0,2*Math.PI,!1),w.closePath(),w.fillStyle=t.color,w.fill()}function c(t){var e=t.l[0]+t.v[0],n=t.l[1]+t.v[1];(e>g.width-t.r||e<t.r)&&(t.v[0]=-t.v[0]*h),(n>g.height-t.r||n<t.r)&&(t.v[1]=-t.v[1]*h),t.l[0]+=t.v[0],t.l[1]+=t.v[1]}function s(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}var u=s(),f=1,h=.9,d=0,v=0,m=100,g=document.querySelector("canvas#universe"),p=document.querySelector(g.dataset.container);g.width=p.clientWidth,g.height=p.clientHeight;var w=g.getContext("2d"),y={m:1e5,r:15,sign:1,color:"white",l:[t(35,g.width-35),t(35,g.height-35)],v:[t(-.1,.1),t(-.1,.1)]},q={m:100,r:7,sign:1,color:"#ec232f",l:[y.l[0],y.l[1]-25],v:[-6,0]},M={m:1e3,r:10,sign:1,color:"#32ee22",l:[y.l[0],y.l[1]+120],v:[3.9,0]},S=[y,q,M];n(),p.addEventListener("mousemove",function(t){d=t.offsetX,v=t.offsetY}),p.addEventListener("mouseout",function(){v=d=0}),p.addEventListener("click",function(n){var r=document.scrollingElement||document.documentElement,o=n.clientY+r.scrollTop-p.offsetTop,i=t(2,25);S.push({r:i,m:t(10,1e3),color:e(),l:[n.clientX,o],sign:Math.sign(Math.random()-.5),v:[t(0,2),t(0,2)]})}),window.addEventListener("resize",function(){g.width=p.clientWidth,g.height=p.clientHeight})}(),function(){function t(){fetch("/api/posts.json").then(function(t){return t.json()}).then(function(t){if("string"==typeof t&&(t=JSON.parse(t)),!(t.length<2)){var n,o=[],i=r();t.filter(function(t){return t.url===location.pathname?(n=t,!1):0!==t.tags.length}).forEach(function(t){if(n){t.sim=i[t.url]?0:e(t.tags,n.tags);for(var r=0;r<o.length;r++){var a=o[r];if(a.sim<t.sim){o.splice(r,0,t),t=null;break}}for(t&&o.push(t);o.length>3;)o.pop()}}),console.log("similar posts:",o);var a=document.querySelector(".post-pager .previous").getAttribute("href"),l=document.querySelector(".post-pager .next").getAttribute("href");if(o.length&&a===o[0].url&&o.shift(),o.length&&l===o[0].url&&o.shift(),o.length){var c=o[0],s=document.querySelector(".post-pager .recommend");s.setAttribute("href",c.url),s.textContent="推荐阅读："+c.title,s.style.display="block"}else console.info("no similar posts found, recommendation disabled")}})}function e(t,e){var n={};t.forEach(function(t){n[t]=!0});var r=e.filter(function(t){return n[t]}).length;return r/Math.sqrt(t.length)/Math.sqrt(e.length)}function n(){var t=r(),e=location.pathname;t[e]=(t[e]||0)+1,window.sessionStorage.setItem("pv",JSON.stringify(t))}function r(){var t=window.sessionStorage.getItem("pv");return t?JSON.parse(t):{}}n(),t()}(),function(){function t(){function t(){var t=window.pageYOffset<a?"affix-top":"affix";r.setAttribute("class",t);var e;for(Array.prototype.forEach.call(r.querySelectorAll("a"),function(t){var n=t.getAttribute("href"),r=document.querySelector(n);window.pageYOffset>r.offsetTop-20&&(e=t),t.parentNode.removeAttribute("class")});e;)e.parentNode.classList.add("active"),e=e.parentNode.parentNode.previousElementSibling}var o=e(n),i=document.querySelector("article");if(!o)return void i.classList.add("collapsed");r.appendChild(o);var a=406;window.addEventListener("scroll",t)}function e(t){var e=document.createElement("ul");e.setAttribute("class","nav level-0 list-unstyled sidenav");for(var n=1;!t.querySelector("h"+n)&&7>n;)n+=1;return 7===n?null:(Array.prototype.forEach.call(t.querySelectorAll("h1,h2,h3,h4,h5,h6"),function(t,r){var o="header-"+r;t.setAttribute("id",o);var i=parseInt(t.nodeName.substr(1)),a=i-n,l=document.createElement("li");l.innerHTML='<a href="#'+o+'">'+t.textContent+'</a><ul class="nav list-unstyled level-'+(a+1)+'"/>';var c=document.createElement("div");c.appendChild(e);var s=c.querySelectorAll("ul.level-"+a);s[s.length-1].appendChild(l)}),e)}var n=document.querySelector(".md"),r=window.asideTOC;t()}();